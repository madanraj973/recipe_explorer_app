<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipe Explorer</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Georgia", "Times New Roman", serif;
      background: #ecfeff;          /* page background */
      color: #022c22;               /* main text color */
    }

    .hero {
      background: #ccfbf1;          /* header background */
      padding: 32px 8vw 28px;
      border-bottom: 1px solid #99f6e4;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    .hero-title {
      font-size: 44px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }
    .hero-sub {
      margin-top: 6px;
      font-size: 15px;
      color: #0f766e;
    }
    .hero-right button {
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid #5eead4;
      background: #f0fdfa;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #0f766e;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 8vw 40px;
    }

    .search-row {
      display: flex;
      gap: 10px;
      margin-bottom: 26px;
    }
    .search-input-wrap {
      flex: 1;
      position: relative;
    }
    .search-input-wrap input {
      width: 100%;
      padding: 14px 44px;
      border-radius: 999px;
      border: 1px solid #99f6e4;
      font-size: 15px;
      outline: none;
      background: #f0fdfa;
      color: #022c22;
    }
    .search-input-wrap input:focus {
      border-color: #0d9488;
      box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.25);
      background: #ffffff;
    }
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
      color: #0f766e;
    }
    .search-row button {
      padding: 0 28px;
      border-radius: 999px;
      border: none;
      background: #0d9488;          /* primary button */
      color: #ffffff;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
    }

    h2.section-title {
      font-size: 22px;
      margin-bottom: 18px;
    }

    #searchResults {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 22px;
      margin-bottom: 32px;
    }

    .card {
      background: #f0fdfa;          /* card background */
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(15, 118, 110, 0.12);
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      position: relative;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 30px rgba(15, 118, 110, 0.22);
    }
    .card img {
      width: 100%;
      height: 190px;
      object-fit: cover;
      display: block;
    }
    .card-content {
      padding: 12px 14px 14px;
    }
    .card-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .card-meta {
      font-size: 13px;
      color: #0f766e;
    }
    .heart {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(240, 253, 250, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #0d9488;               /* heart color */
      pointer-events: none;
    }

    .bottom-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.1fr);
      gap: 26px;
    }
    @media (max-width: 900px) {
      .bottom-grid { grid-template-columns: 1fr; }
      .hero { flex-direction: column; align-items: flex-start; }
    }

    .panel {
      background: #f0fdfa;          /* panel background */
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 12px 26px rgba(15, 118, 110, 0.12);
      min-height: 200px;
    }

    #recipeDetails img {
      width: 100%;
      border-radius: 16px;
      margin: 8px 0 12px;
    }
    #recipeDetails h3 {
      font-size: 24px;
      margin-bottom: 4px;
    }
    .tags {
      font-size: 13px;
      color: #0f766e;
      margin-bottom: 10px;
    }
    .detail-subtitle {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #0f766e;
      margin: 10px 0 6px;
    }
    ul.ingredients {
      padding-left: 18px;
      font-size: 14px;
      line-height: 1.6;
    }
    .instructions {
      margin-top: 4px;
      font-size: 14px;
      line-height: 1.7;
    }
    .primary-btn {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: #0d9488;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    #favoritesList .fav-item {
      padding: 8px 10px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid #a5f3fc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }
    #favoritesList .fav-name { cursor: pointer; }
    #favoritesList button {
      border: none;
      background: transparent;
      color: #0f766e;
      cursor: pointer;
      font-size: 16px;
    }
    .empty {
      font-size: 14px;
      color: #0f766e;
    }

    /* Popup modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal {
      width: min(800px, 95vw);
      max-height: 90vh;
      background: #f0fdfa;
      border-radius: 20px;
      padding: 18px 20px 22px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.45);
      overflow-y: auto;
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 12px;
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
      color: #0f766e;
    }
  </style>
</head>
<body>
  <header class="hero">
    <div>
      <div class="hero-title">Recipe Explorer</div>
      <div class="hero-sub">Discover delicious meals from around the world</div>
    </div>
    <div class="hero-right">
      <button id="favHeaderBtn">‚ô° Favorites (0)</button>
    </div>
  </header>

  <main class="page">
    <div class="search-row">
      <div class="search-input-wrap">
        <span class="search-icon">üîç</span>
        <input id="searchInput" placeholder="Search recipes, e.g. chicken, pasta, biryani..." />
      </div>
      <button onclick="searchRecipes()">Search</button>
    </div>

    <h2 class="section-title">Search Results</h2>
    <section id="searchResults">
      <p class="empty">Type a keyword above and press Search to see recipes.</p>
    </section>

    <div class="bottom-grid">
      <section class="panel" id="recipeDetails">
        <p class="empty">Choose a recipe from the list to open it.</p>
      </section>

      <section class="panel">
        <h2 style="font-size: 18px; margin-bottom: 10px;">Favorites</h2>
        <div id="favoritesList">
          <p class="empty">No favorites yet. Tap ‚ÄúAdd to Favorites‚Äù.</p>
        </div>
      </section>
    </div>
  </main>

  <!-- Recipe detail popup -->
  <div id="detailModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <button class="modal-close" id="modalCloseBtn">‚úï</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    let currentRecipe = null;
    let favoritesCache = [];

    async function searchRecipes() {
      const query = document.getElementById('searchInput').value.trim();
      if (!query) return;
      const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
      const meals = await res.json();
      renderCards(meals);
    }

    function renderCards(meals) {
      const container = document.getElementById('searchResults');
      container.innerHTML = '';

      if (!meals || meals.length === 0) {
        container.innerHTML = '<p class="empty">No recipes found.</p>';
        return;
      }

      meals.forEach(meal => {
        const card = document.createElement('article');
        card.className = 'card';
        card.addEventListener('click', () => showRecipeDetails(meal.idMeal));

        card.innerHTML = `
          <img src="${meal.strMealThumb}" alt="${meal.strMeal}">
          <div class="heart">‚ô°</div>
          <div class="card-content">
            <div class="card-title">${meal.strMeal}</div>
            <div class="card-meta">${meal.strArea || ''} ‚Ä¢ ${meal.strCategory || ''}</div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function openModal() {
      document.getElementById('detailModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('detailModal').style.display = 'none';
    }

    async function showRecipeDetails(id) {
      const res = await fetch(`/recipe/${id}`);
      const meal = await res.json();
      currentRecipe = meal;

      const modalContent = document.getElementById('modalContent');
      if (!meal || !meal.idMeal) {
        modalContent.innerHTML = '<p class="empty">Unable to load recipe.</p>';
        openModal();
        return;
      }

      const ingredients = getIngredientsList(meal);
      modalContent.innerHTML = `
        <h3 style="font-size:24px; margin-bottom:6px;">${meal.strMeal}</h3>
        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" style="width:100%; border-radius:16px; margin:8px 0 12px;">
        <div class="tags">
          ${meal.strArea || ''} ‚Ä¢ ${meal.strCategory || ''}${meal.strTags ? ' ‚Ä¢ ' + meal.strTags : ''}
        </div>

        <div class="detail-subtitle">Ingredients</div>
        <ul class="ingredients">
          ${ingredients.map(i => `<li>${i}</li>`).join('')}
        </ul>

        <div class="detail-subtitle">Instructions</div>
        <div class="instructions">${meal.strInstructions}</div>

        <button class="primary-btn" id="favBtn">Add to Favorites</button>
      `;

      openModal();
      document.getElementById('favBtn').addEventListener('click', addToFavorites);
    }

    function getIngredientsList(meal) {
      const list = [];
      for (let i = 1; i <= 20; i++) {
        const ing = meal[`strIngredient${i}`];
        const meas = meal[`strMeasure${i}`];
        if (ing && ing.trim()) list.push(`${ing} - ${meas}`);
      }
      return list;
    }

    async function addToFavorites() {
      if (!currentRecipe) return;
      const res = await fetch('/favorites', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(currentRecipe),
      });
      const favs = await res.json();
      favoritesCache = favs || [];
      renderFavorites();
    }

    async function loadFavorites() {
      const res = await fetch('/favorites');
      const favs = await res.json();
      favoritesCache = favs || [];
      renderFavorites();
    }

    function renderFavorites() {
      const list = document.getElementById('favoritesList');
      const headerBtn = document.getElementById('favHeaderBtn');
      headerBtn.textContent = `‚ô° Favorites (${favoritesCache.length})`;

      list.innerHTML = '';
      if (favoritesCache.length === 0) {
        list.innerHTML = '<p class="empty">No favorites yet. Tap ‚ÄúAdd to Favorites‚Äù.</p>';
        return;
      }

      favoritesCache.forEach(fav => {
        const row = document.createElement('div');
        row.className = 'fav-item';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'fav-name';
        nameSpan.textContent = fav.strMeal;
        nameSpan.addEventListener('click', () => showRecipeDetails(fav.idMeal));

        const btn = document.createElement('button');
        btn.textContent = '‚úï';
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          removeFavorite(fav.idMeal);
        });

        row.appendChild(nameSpan);
        row.appendChild(btn);
        list.appendChild(row);
      });
    }

    async function removeFavorite(idMeal) {
      const res = await fetch(`/favorites/${idMeal}`, { method: 'DELETE' });
      const favs = await res.json();
      favoritesCache = favs || [];
      renderFavorites();
    }

    window.onload = () => {
      loadFavorites();

      const closeBtn = document.getElementById('modalCloseBtn');
      const overlay = document.getElementById('detailModal');

      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closeModal();
      });
    };
  </script>
</body>
</html>
